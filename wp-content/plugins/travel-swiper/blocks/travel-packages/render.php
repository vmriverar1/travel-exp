<?php
$seo_text = get_field('seo_text') ?: 'Texto descriptivo. Texto descriptivo.';
$cta_text = get_field('cta_text') ?: 'View Trip';

// Paquetes seleccionados (CPT)
$packages = get_field('selected_packages') ?: [];
if (empty($packages)) return;
?>

<section class="travel-packages-block">
    <!-- === GRID PRINCIPAL (DESKTOP) === -->
    <div class="travel-destinations__grid desktop-only">

        <!-- === COLUMNA 4 (TEXTO + IMAGEN) === -->
        <div class="travel-column column-4">
            <article class="travel-destination-text">
                <h3 class="travel-destinations__heading">
                    <?php echo esc_html(get_field('packages_title') ?: 'Popular Packages'); ?>
                </h3>
                <p class="travel-destinations__text"><?php echo esc_html($seo_text); ?></p>
            </article>

            <?php
            $pkg6 = $packages[6] ?? null;
            if ($pkg6):
                $image = get_field('main_image', $pkg6->ID) ?: get_the_post_thumbnail_url($pkg6->ID, 'large');
                $raw_price = get_field('price_from', $pkg6->ID);
                $price = $raw_price ? '$' . number_format((float) $raw_price, 0, '.', ',') : null;
                $day = get_field('days', $pkg6->ID) ?: 'Full Day';
                $locs  = get_field('locations', $pkg6->ID);
                $tag   = get_field('tag_label', $pkg6->ID) ?: 'By Train';
                if (is_array($locs)) {
                    $loc_names = [];
                    foreach ($locs as $loc_id) {
                        $post_obj = get_post($loc_id);
                        if ($post_obj) {
                            $loc_names[] = $post_obj->post_title;
                        }
                    }
                    $locs = implode(', ', $loc_names);
                }
            ?>
                <article class="travel-destination-item large travel-package-card">
                    <div class="card-thumb">
                        <?php if ($image): ?>
                            <img src="<?php echo esc_url($image); ?>" alt="<?php echo esc_attr(get_the_title($pkg6)); ?>">
                        <?php endif; ?>

                        <span class="card-tag"><?php echo esc_html($tag); ?></span>
                        <button class="favorite-btn" type="button" aria-label="Add to favorites">
                            <svg width="16" height="15" viewBox="0 0 16 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M7.81383 14.7194C7.73973 14.7194 7.66563 14.6911 7.60898 14.6348L1.524 8.59288C1.49335 8.56261 1.47085 8.52692 1.45688 8.48929C-0.503553 6.45203 -0.48687 3.20042 1.51546 1.18412C3.04253 -0.354195 5.53643 -0.362731 7.07436 1.16434L7.78745 1.87239L8.49551 1.15929C10.0222 -0.378638 12.5161 -0.387561 14.054 1.13951C16.0703 3.14184 16.1103 6.39345 14.1642 8.44428C14.1502 8.4823 14.1281 8.518 14.0978 8.54826L8.05554 14.6332C8.00123 14.6879 7.92712 14.719 7.84992 14.7194C7.84332 14.7198 7.83828 14.7194 7.83246 14.719C7.82625 14.7194 7.82004 14.7194 7.81383 14.7194ZM2.0175 8.26271L7.83013 14.0346L13.602 8.22197C13.6164 8.18473 13.6385 8.1502 13.6672 8.1211C15.4717 6.30383 15.4612 3.35716 13.6439 1.5527C12.3337 0.251432 10.2092 0.259192 8.90831 1.56938L7.99541 2.48888C7.88212 2.60294 7.69783 2.60333 7.58377 2.49043L6.66427 1.57753C5.35408 0.276263 3.22953 0.283634 1.92827 1.59382C1.05416 2.47414 0.575015 3.64233 0.57967 4.88268C0.583938 6.12342 1.07123 7.28773 1.95155 8.16184C1.98103 8.19171 2.00315 8.22585 2.0175 8.26271Z" fill="black" />
                            </svg>
                        </button>

                        <div class="card-overlay">
                            <div class="card-left">
                                <h4 class="card-title"><?php echo esc_html(get_the_title($pkg6)); ?></h4>
                                <div class="card-info">
                                    <?php if ($locs): ?><p><span>
                                                <svg width="13" height="18" viewBox="0 0 13 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M6.44287 0C6.01995 0.000442936 5.60112 0.0436682 5.18638 0.129676C4.77164 0.215684 4.36895 0.342826 3.9783 0.511101C3.58765 0.679377 3.21653 0.885562 2.86494 1.12966C2.51335 1.37375 2.18803 1.65107 1.88898 1.96163C1.58992 2.27218 1.32287 2.61002 1.08782 2.97513C0.852763 3.34024 0.654215 3.72564 0.492172 4.13131C0.330128 4.53699 0.207695 4.95517 0.124873 5.38586C0.0420507 5.81654 0.000426401 6.25148 0 6.69067C0 11.7256 5.75954 17.2065 6.00684 17.4363L6.43636 17.8418C6.98303 17.3011 12.7491 12.2324 12.8857 6.69067C12.8853 6.25148 12.8437 5.81654 12.7609 5.38586C12.678 4.95517 12.5556 4.53699 12.3936 4.13131C12.2315 3.72564 12.033 3.34024 11.7979 2.97513C11.5629 2.61002 11.2958 2.27218 10.9968 1.96163C10.6977 1.65107 10.3724 1.37375 10.0208 1.12966C9.66921 0.885562 9.29809 0.679377 8.90744 0.511101C8.51679 0.342826 8.1141 0.215684 7.69936 0.129676C7.28463 0.0436683 6.8658 0.000442936 6.44287 0ZM6.44287 16.0036C5.14128 14.6519 1.30159 10.3874 1.30159 6.69067C1.30159 5.98268 1.43204 5.30162 1.69295 4.64752C1.95385 3.99341 2.32535 3.41604 2.80744 2.91541C3.28953 2.41478 3.84551 2.029 4.47539 1.75806C5.10527 1.48712 5.7611 1.35165 6.44287 1.35165C7.12465 1.35165 7.78048 1.48712 8.41035 1.75806C9.04023 2.029 9.59622 2.41478 10.0783 2.91541C10.5604 3.41605 10.9319 3.99341 11.1928 4.64752C11.4537 5.30162 11.5842 5.98268 11.5842 6.69067C11.5842 10.455 7.74446 14.6654 6.44287 16.0036ZM6.44287 3.62243C2.42096 3.75759 2.42096 9.81299 6.44287 9.94815C10.4648 9.81299 10.4648 3.75759 6.44287 3.62243ZM6.44287 8.5965C6.21158 8.5965 5.9891 8.55054 5.77542 8.45863C5.56174 8.36672 5.37313 8.23584 5.20958 8.06601C5.04604 7.89618 4.92001 7.70031 4.8315 7.47841C4.74299 7.25651 4.69874 7.02547 4.69874 6.78529C4.69874 6.54511 4.74299 6.31407 4.8315 6.09217C4.92001 5.87027 5.04604 5.6744 5.20958 5.50457C5.37313 5.33473 5.56174 5.20386 5.77542 5.11195C5.9891 5.02003 6.21158 4.97408 6.44287 4.97408C6.67416 4.97408 6.89664 5.02003 7.11032 5.11195C7.324 5.20386 7.51261 5.33473 7.67616 5.50457C7.8397 5.6744 7.96573 5.87027 8.05424 6.09217C8.14275 6.31407 8.187 6.54511 8.187 6.78529C8.187 7.02547 8.14275 7.25651 8.05424 7.47841C7.96573 7.70031 7.8397 7.89618 7.67616 8.06601C7.51261 8.23584 7.324 8.36672 7.11032 8.45863C6.89664 8.55054 6.67416 8.5965 6.44287 8.5965Z" fill="white" />
                                                </svg>
                                            </span><?php echo esc_html($locs); ?></p><?php endif; ?>
                                    <?php if ($day): ?>
                                        <span>
                                            <?php echo esc_html(is_numeric($day) ? "{$day} Days" : $day); ?>
                                        </span>
                                    <?php endif; ?>
                                    <?php if ($price): ?><span> | From <?php echo esc_html($price); ?></span><?php endif; ?>
                                </div>
                            </div>
                            <a href="<?php echo esc_url(get_permalink($pkg6)); ?>" class="card-button">
                                <?php echo esc_html($cta_text); ?>
                            </a>
                        </div>
                    </div>
                </article>
            <?php endif; ?>
        </div>

        <!-- === COLUMNA 2 y 3 (50% + 50%) === -->
        <?php
        $columns = [['start' => 2, 'end' => 3], ['start' => 4, 'end' => 5]];
        foreach ($columns as $col_index => $range):
        ?>
            <div class="travel-column column-<?php echo $col_index + 2; ?>">
                <?php
                for ($i = $range['start']; $i <= $range['end']; $i++):
                    $pkg = $packages[$i] ?? null;
                    if (!$pkg) continue;
                    $image = get_field('main_image', $pkg->ID) ?: get_the_post_thumbnail_url($pkg->ID, 'large');
                    $raw_price = get_field('price_from', $pkg->ID);
                    $price = $raw_price ? '$' . number_format((float) $raw_price, 0, '.', ',') : null;
                    $day = get_field('days', $pkg->ID) ?: 'Full Day';
                    $locs  = get_field('locations', $pkg->ID);
                    $tag   = get_field('tag_label', $pkg->ID) ?: 'By Train';
                    if (is_array($locs)) {
                        $loc_names = [];
                        foreach ($locs as $loc_id) {
                            $post_obj = get_post($loc_id);
                            if ($post_obj) {
                                $loc_names[] = $post_obj->post_title;
                            }
                        }
                        $locs = implode(', ', $loc_names);
                    }
                ?>
                    <article class="travel-destination-item medium travel-package-card">
                        <div class="card-thumb">
                            <?php if ($image): ?>
                                <img src="<?php echo esc_url($image); ?>" alt="<?php echo esc_attr(get_the_title($pkg)); ?>">
                            <?php endif; ?>

                            <span class="card-tag"><?php echo esc_html($tag); ?></span>
                            <button class="favorite-btn" type="button" aria-label="Add to favorites">

                                <svg width="16" height="15" viewBox="0 0 16 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7.81383 14.7194C7.73973 14.7194 7.66563 14.6911 7.60898 14.6348L1.524 8.59288C1.49335 8.56261 1.47085 8.52692 1.45688 8.48929C-0.503553 6.45203 -0.48687 3.20042 1.51546 1.18412C3.04253 -0.354195 5.53643 -0.362731 7.07436 1.16434L7.78745 1.87239L8.49551 1.15929C10.0222 -0.378638 12.5161 -0.387561 14.054 1.13951C16.0703 3.14184 16.1103 6.39345 14.1642 8.44428C14.1502 8.4823 14.1281 8.518 14.0978 8.54826L8.05554 14.6332C8.00123 14.6879 7.92712 14.719 7.84992 14.7194C7.84332 14.7198 7.83828 14.7194 7.83246 14.719C7.82625 14.7194 7.82004 14.7194 7.81383 14.7194ZM2.0175 8.26271L7.83013 14.0346L13.602 8.22197C13.6164 8.18473 13.6385 8.1502 13.6672 8.1211C15.4717 6.30383 15.4612 3.35716 13.6439 1.5527C12.3337 0.251432 10.2092 0.259192 8.90831 1.56938L7.99541 2.48888C7.88212 2.60294 7.69783 2.60333 7.58377 2.49043L6.66427 1.57753C5.35408 0.276263 3.22953 0.283634 1.92827 1.59382C1.05416 2.47414 0.575015 3.64233 0.57967 4.88268C0.583938 6.12342 1.07123 7.28773 1.95155 8.16184C1.98103 8.19171 2.00315 8.22585 2.0175 8.26271Z" fill="black" />
                                </svg>

                            </button>

                            <div class="card-overlay">
                                <div class="card-left">
                                    <h4 class="card-title"><?php echo esc_html(get_the_title($pkg)); ?></h4>
                                    <div class="card-info">
                                        <?php if ($locs): ?><p><span>
                                                    <svg width="13" height="18" viewBox="0 0 13 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M6.44287 0C6.01995 0.000442936 5.60112 0.0436682 5.18638 0.129676C4.77164 0.215684 4.36895 0.342826 3.9783 0.511101C3.58765 0.679377 3.21653 0.885562 2.86494 1.12966C2.51335 1.37375 2.18803 1.65107 1.88898 1.96163C1.58992 2.27218 1.32287 2.61002 1.08782 2.97513C0.852763 3.34024 0.654215 3.72564 0.492172 4.13131C0.330128 4.53699 0.207695 4.95517 0.124873 5.38586C0.0420507 5.81654 0.000426401 6.25148 0 6.69067C0 11.7256 5.75954 17.2065 6.00684 17.4363L6.43636 17.8418C6.98303 17.3011 12.7491 12.2324 12.8857 6.69067C12.8853 6.25148 12.8437 5.81654 12.7609 5.38586C12.678 4.95517 12.5556 4.53699 12.3936 4.13131C12.2315 3.72564 12.033 3.34024 11.7979 2.97513C11.5629 2.61002 11.2958 2.27218 10.9968 1.96163C10.6977 1.65107 10.3724 1.37375 10.0208 1.12966C9.66921 0.885562 9.29809 0.679377 8.90744 0.511101C8.51679 0.342826 8.1141 0.215684 7.69936 0.129676C7.28463 0.0436683 6.8658 0.000442936 6.44287 0ZM6.44287 16.0036C5.14128 14.6519 1.30159 10.3874 1.30159 6.69067C1.30159 5.98268 1.43204 5.30162 1.69295 4.64752C1.95385 3.99341 2.32535 3.41604 2.80744 2.91541C3.28953 2.41478 3.84551 2.029 4.47539 1.75806C5.10527 1.48712 5.7611 1.35165 6.44287 1.35165C7.12465 1.35165 7.78048 1.48712 8.41035 1.75806C9.04023 2.029 9.59622 2.41478 10.0783 2.91541C10.5604 3.41605 10.9319 3.99341 11.1928 4.64752C11.4537 5.30162 11.5842 5.98268 11.5842 6.69067C11.5842 10.455 7.74446 14.6654 6.44287 16.0036ZM6.44287 3.62243C2.42096 3.75759 2.42096 9.81299 6.44287 9.94815C10.4648 9.81299 10.4648 3.75759 6.44287 3.62243ZM6.44287 8.5965C6.21158 8.5965 5.9891 8.55054 5.77542 8.45863C5.56174 8.36672 5.37313 8.23584 5.20958 8.06601C5.04604 7.89618 4.92001 7.70031 4.8315 7.47841C4.74299 7.25651 4.69874 7.02547 4.69874 6.78529C4.69874 6.54511 4.74299 6.31407 4.8315 6.09217C4.92001 5.87027 5.04604 5.6744 5.20958 5.50457C5.37313 5.33473 5.56174 5.20386 5.77542 5.11195C5.9891 5.02003 6.21158 4.97408 6.44287 4.97408C6.67416 4.97408 6.89664 5.02003 7.11032 5.11195C7.324 5.20386 7.51261 5.33473 7.67616 5.50457C7.8397 5.6744 7.96573 5.87027 8.05424 6.09217C8.14275 6.31407 8.187 6.54511 8.187 6.78529C8.187 7.02547 8.14275 7.25651 8.05424 7.47841C7.96573 7.70031 7.8397 7.89618 7.67616 8.06601C7.51261 8.23584 7.324 8.36672 7.11032 8.45863C6.89664 8.55054 6.67416 8.5965 6.44287 8.5965Z" fill="white" />
                                                    </svg>
                                                </span><?php echo esc_html($locs); ?></p><?php endif; ?>
                                        <?php if ($day): ?>
                                            <span>
                                                <?php echo esc_html(is_numeric($day) ? "{$day} Days" : $day); ?>
                                            </span>
                                        <?php endif; ?>
                                        <?php if ($price): ?><span> | From <?php echo esc_html($price); ?></span><?php endif; ?>
                                    </div>
                                </div>
                                <a href="<?php echo esc_url(get_permalink($pkg)); ?>" class="card-button">
                                    <?php echo esc_html($cta_text); ?>
                                </a>
                            </div>
                        </div>
                    </article>
                <?php endfor; ?>
            </div>
        <?php endforeach; ?>

        <!-- === COLUMNA 1 (20% + 80%) === -->
        <div class="travel-column column-1">
            <?php
            $pkg1 = $packages[0] ?? null;
            $pkg2 = $packages[1] ?? null;
            foreach ([$pkg1, $pkg2] as $i => $pkg):
                if (!$pkg) continue;
                $image = get_field('main_image', $pkg->ID) ?: get_the_post_thumbnail_url($pkg->ID, 'large');
                $raw_price = get_field('price_from', $pkg->ID);
                $price = $raw_price ? '$' . number_format((float) $raw_price, 0, '.', ',') : null;
                $day = get_field('days', $pkg->ID) ?: 'Full Day';
                $locs  = get_field('locations', $pkg->ID);
                $tag   = get_field('tag_label', $pkg->ID) ?: 'By Train';
                $class = $i === 0 ? 'small' : 'large';
                if (is_array($locs)) {
                    $loc_names = [];
                    foreach ($locs as $loc_id) {
                        $post_obj = get_post($loc_id);
                        if ($post_obj) {
                            $loc_names[] = $post_obj->post_title;
                        }
                    }
                    $locs = implode(', ', $loc_names);
                }
            ?>
                <article class="travel-destination-item <?php echo esc_attr($class); ?> travel-package-card">
                    <div class="card-thumb">
                        <?php if ($image): ?>
                            <img src="<?php echo esc_url($image); ?>" alt="<?php echo esc_attr(get_the_title($pkg)); ?>">
                        <?php endif; ?>

                        <span class="card-tag"><?php echo esc_html($tag); ?></span>
                        <button class="favorite-btn" type="button" aria-label="Add to favorites">

                            <svg width="16" height="15" viewBox="0 0 16 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M7.81383 14.7194C7.73973 14.7194 7.66563 14.6911 7.60898 14.6348L1.524 8.59288C1.49335 8.56261 1.47085 8.52692 1.45688 8.48929C-0.503553 6.45203 -0.48687 3.20042 1.51546 1.18412C3.04253 -0.354195 5.53643 -0.362731 7.07436 1.16434L7.78745 1.87239L8.49551 1.15929C10.0222 -0.378638 12.5161 -0.387561 14.054 1.13951C16.0703 3.14184 16.1103 6.39345 14.1642 8.44428C14.1502 8.4823 14.1281 8.518 14.0978 8.54826L8.05554 14.6332C8.00123 14.6879 7.92712 14.719 7.84992 14.7194C7.84332 14.7198 7.83828 14.7194 7.83246 14.719C7.82625 14.7194 7.82004 14.7194 7.81383 14.7194ZM2.0175 8.26271L7.83013 14.0346L13.602 8.22197C13.6164 8.18473 13.6385 8.1502 13.6672 8.1211C15.4717 6.30383 15.4612 3.35716 13.6439 1.5527C12.3337 0.251432 10.2092 0.259192 8.90831 1.56938L7.99541 2.48888C7.88212 2.60294 7.69783 2.60333 7.58377 2.49043L6.66427 1.57753C5.35408 0.276263 3.22953 0.283634 1.92827 1.59382C1.05416 2.47414 0.575015 3.64233 0.57967 4.88268C0.583938 6.12342 1.07123 7.28773 1.95155 8.16184C1.98103 8.19171 2.00315 8.22585 2.0175 8.26271Z" fill="black" />
                            </svg>

                        </button>

                        <div class="card-overlay">
                            <div class="card-left">
                                <h4 class="card-title"><?php echo esc_html(get_the_title($pkg)); ?></h4>
                                <div class="card-info">
                                    <?php if ($locs): ?><p><span>
                                                <svg width="13" height="18" viewBox="0 0 13 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M6.44287 0C6.01995 0.000442936 5.60112 0.0436682 5.18638 0.129676C4.77164 0.215684 4.36895 0.342826 3.9783 0.511101C3.58765 0.679377 3.21653 0.885562 2.86494 1.12966C2.51335 1.37375 2.18803 1.65107 1.88898 1.96163C1.58992 2.27218 1.32287 2.61002 1.08782 2.97513C0.852763 3.34024 0.654215 3.72564 0.492172 4.13131C0.330128 4.53699 0.207695 4.95517 0.124873 5.38586C0.0420507 5.81654 0.000426401 6.25148 0 6.69067C0 11.7256 5.75954 17.2065 6.00684 17.4363L6.43636 17.8418C6.98303 17.3011 12.7491 12.2324 12.8857 6.69067C12.8853 6.25148 12.8437 5.81654 12.7609 5.38586C12.678 4.95517 12.5556 4.53699 12.3936 4.13131C12.2315 3.72564 12.033 3.34024 11.7979 2.97513C11.5629 2.61002 11.2958 2.27218 10.9968 1.96163C10.6977 1.65107 10.3724 1.37375 10.0208 1.12966C9.66921 0.885562 9.29809 0.679377 8.90744 0.511101C8.51679 0.342826 8.1141 0.215684 7.69936 0.129676C7.28463 0.0436683 6.8658 0.000442936 6.44287 0ZM6.44287 16.0036C5.14128 14.6519 1.30159 10.3874 1.30159 6.69067C1.30159 5.98268 1.43204 5.30162 1.69295 4.64752C1.95385 3.99341 2.32535 3.41604 2.80744 2.91541C3.28953 2.41478 3.84551 2.029 4.47539 1.75806C5.10527 1.48712 5.7611 1.35165 6.44287 1.35165C7.12465 1.35165 7.78048 1.48712 8.41035 1.75806C9.04023 2.029 9.59622 2.41478 10.0783 2.91541C10.5604 3.41605 10.9319 3.99341 11.1928 4.64752C11.4537 5.30162 11.5842 5.98268 11.5842 6.69067C11.5842 10.455 7.74446 14.6654 6.44287 16.0036ZM6.44287 3.62243C2.42096 3.75759 2.42096 9.81299 6.44287 9.94815C10.4648 9.81299 10.4648 3.75759 6.44287 3.62243ZM6.44287 8.5965C6.21158 8.5965 5.9891 8.55054 5.77542 8.45863C5.56174 8.36672 5.37313 8.23584 5.20958 8.06601C5.04604 7.89618 4.92001 7.70031 4.8315 7.47841C4.74299 7.25651 4.69874 7.02547 4.69874 6.78529C4.69874 6.54511 4.74299 6.31407 4.8315 6.09217C4.92001 5.87027 5.04604 5.6744 5.20958 5.50457C5.37313 5.33473 5.56174 5.20386 5.77542 5.11195C5.9891 5.02003 6.21158 4.97408 6.44287 4.97408C6.67416 4.97408 6.89664 5.02003 7.11032 5.11195C7.324 5.20386 7.51261 5.33473 7.67616 5.50457C7.8397 5.6744 7.96573 5.87027 8.05424 6.09217C8.14275 6.31407 8.187 6.54511 8.187 6.78529C8.187 7.02547 8.14275 7.25651 8.05424 7.47841C7.96573 7.70031 7.8397 7.89618 7.67616 8.06601C7.51261 8.23584 7.324 8.36672 7.11032 8.45863C6.89664 8.55054 6.67416 8.5965 6.44287 8.5965Z" fill="white" />
                                                </svg>
                                            </span><?php echo esc_html($locs); ?></p><?php endif; ?>
                                    <?php if ($day): ?>
                                        <span>
                                            <?php echo esc_html(is_numeric($day) ? "{$day} Days" : $day); ?>
                                        </span>
                                    <?php endif; ?>
                                    <?php if ($price): ?><span> | From <?php echo esc_html($price); ?></span><?php endif; ?>
                                </div>
                            </div>
                            <a href="<?php echo esc_url(get_permalink($pkg)); ?>" class="card-button">
                                <?php echo esc_html($cta_text); ?>
                            </a>
                        </div>
                    </div>
                </article>
            <?php endforeach; ?>
        </div>
    </div>

    <!-- === MOBILE === -->
    <aside class="travel-destinations__content mobile-only">
        <h3 class="travel-destinations__heading">
            <?php echo esc_html(get_field('packages_title') ?: 'Popular Packages'); ?>
        </h3>
        <p class="travel-destinations__text"><?php echo esc_html($seo_text); ?></p>
    </aside>

    <section class="travel-swiper-block travel-swiper--packages swiper-rows-1 mobile-only">
        <div class="tsb-swiper swiper">
            <div class="swiper-wrapper">
                <?php foreach ($packages as $pkg):
                    $image = get_field('main_image', $pkg->ID) ?: get_the_post_thumbnail_url($pkg->ID, 'large');
                    $price = get_field('price_from', $pkg->ID);
                    $day = get_field('days', $pkg->ID) ?: 'Full Day';
                    $locs  = get_field('locations', $pkg->ID);
                    $tag   = get_field('tag_label', $pkg->ID) ?: 'By Train';
                    if (is_array($locs)) {
                        $locs = implode(', ', array_map(fn($term) => is_object($term) ? $term->name : $term, $locs));
                    }
                ?>
                    <div class="swiper-slide">
                        <article class="travel-destination-item travel-package-card">
                            <div class="card-thumb">
                                <?php if ($image): ?>
                                    <img src="<?php echo esc_url($image); ?>" alt="<?php echo esc_attr(get_the_title($pkg)); ?>">
                                <?php endif; ?>

                                <span class="card-tag"><?php echo esc_html($tag); ?></span>
                                <button class="favorite-btn" type="button" aria-label="Add to favorites">

                                    <svg width="16" height="15" viewBox="0 0 16 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M7.81383 14.7194C7.73973 14.7194 7.66563 14.6911 7.60898 14.6348L1.524 8.59288C1.49335 8.56261 1.47085 8.52692 1.45688 8.48929C-0.503553 6.45203 -0.48687 3.20042 1.51546 1.18412C3.04253 -0.354195 5.53643 -0.362731 7.07436 1.16434L7.78745 1.87239L8.49551 1.15929C10.0222 -0.378638 12.5161 -0.387561 14.054 1.13951C16.0703 3.14184 16.1103 6.39345 14.1642 8.44428C14.1502 8.4823 14.1281 8.518 14.0978 8.54826L8.05554 14.6332C8.00123 14.6879 7.92712 14.719 7.84992 14.7194C7.84332 14.7198 7.83828 14.7194 7.83246 14.719C7.82625 14.7194 7.82004 14.7194 7.81383 14.7194ZM2.0175 8.26271L7.83013 14.0346L13.602 8.22197C13.6164 8.18473 13.6385 8.1502 13.6672 8.1211C15.4717 6.30383 15.4612 3.35716 13.6439 1.5527C12.3337 0.251432 10.2092 0.259192 8.90831 1.56938L7.99541 2.48888C7.88212 2.60294 7.69783 2.60333 7.58377 2.49043L6.66427 1.57753C5.35408 0.276263 3.22953 0.283634 1.92827 1.59382C1.05416 2.47414 0.575015 3.64233 0.57967 4.88268C0.583938 6.12342 1.07123 7.28773 1.95155 8.16184C1.98103 8.19171 2.00315 8.22585 2.0175 8.26271Z" fill="black" />
                                    </svg>

                                </button>

                                <div class="card-overlay">
                                    <div class="card-left">
                                        <h4 class="card-title"><?php echo esc_html(get_the_title($pkg)); ?></h4>
                                        <div class="card-info">
                                            <?php if ($locs): ?><p><span>
                                                        <svg width="13" height="18" viewBox="0 0 13 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M6.44287 0C6.01995 0.000442936 5.60112 0.0436682 5.18638 0.129676C4.77164 0.215684 4.36895 0.342826 3.9783 0.511101C3.58765 0.679377 3.21653 0.885562 2.86494 1.12966C2.51335 1.37375 2.18803 1.65107 1.88898 1.96163C1.58992 2.27218 1.32287 2.61002 1.08782 2.97513C0.852763 3.34024 0.654215 3.72564 0.492172 4.13131C0.330128 4.53699 0.207695 4.95517 0.124873 5.38586C0.0420507 5.81654 0.000426401 6.25148 0 6.69067C0 11.7256 5.75954 17.2065 6.00684 17.4363L6.43636 17.8418C6.98303 17.3011 12.7491 12.2324 12.8857 6.69067C12.8853 6.25148 12.8437 5.81654 12.7609 5.38586C12.678 4.95517 12.5556 4.53699 12.3936 4.13131C12.2315 3.72564 12.033 3.34024 11.7979 2.97513C11.5629 2.61002 11.2958 2.27218 10.9968 1.96163C10.6977 1.65107 10.3724 1.37375 10.0208 1.12966C9.66921 0.885562 9.29809 0.679377 8.90744 0.511101C8.51679 0.342826 8.1141 0.215684 7.69936 0.129676C7.28463 0.0436683 6.8658 0.000442936 6.44287 0ZM6.44287 16.0036C5.14128 14.6519 1.30159 10.3874 1.30159 6.69067C1.30159 5.98268 1.43204 5.30162 1.69295 4.64752C1.95385 3.99341 2.32535 3.41604 2.80744 2.91541C3.28953 2.41478 3.84551 2.029 4.47539 1.75806C5.10527 1.48712 5.7611 1.35165 6.44287 1.35165C7.12465 1.35165 7.78048 1.48712 8.41035 1.75806C9.04023 2.029 9.59622 2.41478 10.0783 2.91541C10.5604 3.41605 10.9319 3.99341 11.1928 4.64752C11.4537 5.30162 11.5842 5.98268 11.5842 6.69067C11.5842 10.455 7.74446 14.6654 6.44287 16.0036ZM6.44287 3.62243C2.42096 3.75759 2.42096 9.81299 6.44287 9.94815C10.4648 9.81299 10.4648 3.75759 6.44287 3.62243ZM6.44287 8.5965C6.21158 8.5965 5.9891 8.55054 5.77542 8.45863C5.56174 8.36672 5.37313 8.23584 5.20958 8.06601C5.04604 7.89618 4.92001 7.70031 4.8315 7.47841C4.74299 7.25651 4.69874 7.02547 4.69874 6.78529C4.69874 6.54511 4.74299 6.31407 4.8315 6.09217C4.92001 5.87027 5.04604 5.6744 5.20958 5.50457C5.37313 5.33473 5.56174 5.20386 5.77542 5.11195C5.9891 5.02003 6.21158 4.97408 6.44287 4.97408C6.67416 4.97408 6.89664 5.02003 7.11032 5.11195C7.324 5.20386 7.51261 5.33473 7.67616 5.50457C7.8397 5.6744 7.96573 5.87027 8.05424 6.09217C8.14275 6.31407 8.187 6.54511 8.187 6.78529C8.187 7.02547 8.14275 7.25651 8.05424 7.47841C7.96573 7.70031 7.8397 7.89618 7.67616 8.06601C7.51261 8.23584 7.324 8.36672 7.11032 8.45863C6.89664 8.55054 6.67416 8.5965 6.44287 8.5965Z" fill="white" />
                                                        </svg>
                                                    </span><?php echo esc_html($locs); ?></p><?php endif; ?>
                                            <?php if ($day): ?>
                                                <span>
                                                    <?php echo esc_html(is_numeric($day) ? "{$day} Days" : $day); ?>
                                                </span>
                                            <?php endif; ?>
                                            <?php if ($price): ?><span> | From <?php echo esc_html($price); ?></span><?php endif; ?>
                                        </div>
                                    </div>
                                    <a href="<?php echo esc_url(get_permalink($pkg)); ?>" class="card-button">
                                        <?php echo esc_html($cta_text); ?>
                                    </a>
                                </div>
                            </div>
                        </article>
                    </div>
                <?php endforeach; ?>
            </div>
            <div class="swiper-controls">
                <div class="swiper-button-prev"></div>
                <div class="swiper-pagination__mobile"></div>
                <div class="swiper-button-next"></div>
            </div>
        </div>
    </section>
</section>